<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, user-scalable=no"
  />

  <!-- Icons & Fonts -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Poppins:wght@600;700&display=swap"
    rel="stylesheet"
  />

  <!-- App Icons -->
  <link
    rel="apple-touch-icon"
    href="https://drive.google.com/uc?export=view&id=1pT2_mI_B9CrnOde6YK__OzBd2gYEppXy"
  />
  <link
    rel="icon"
    type="image/png"
    href="https://drive.google.com/uc?export=view&id=1pT2_mI_B9CrnOde6YK__OzBd2gYEppXy"
  />

  <title>My Observations App üë∑üèª‚Äç‚ôÇÔ∏è</title>

  <!-- Main Styles -->
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body class="light-mode">
  <!-- üèÜ Leaderboard Modal -->
  <div id="leaderboardModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <button
        class="close-btn"
        onclick="hideLeaderboardModal()"
        aria-label="Close leaderboard"
      >
        &times;
      </button>
      <h2>üèÜ Monthly Leaderboard</h2>
      <div id="leaderboardContainer">
        <div class="loading-spinner">
          <i class="fas fa-spinner fa-spin"></i> Loading leaderboard...
        </div>
      </div>
    </div>
  </div>

  <!-- üÜò Emergency Contacts Modal -->
  <div id="emergencyContactsModal" class="modal" aria-hidden="true">
    <div class="modal-content modal-wide">
      <button
        class="close-btn"
        onclick="hideEmergencyContactsModal()"
        aria-label="Close emergency contacts"
      >
        &times;
      </button>
      <h2>üÜò EMERGENCY CONTACTS</h2>

      <div id="emergencyContactsTableContainer" class="emergency-table-wrap">
        <!-- Internal emergency contacts -->
        <table class="emergency-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Designation</th>
              <th>Contact No.</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>CAT EMERGENCY</td><td>EMERGENCY</td><td><a href="tel:0543133645">054 313 3645</a></td></tr>
            <tr><td>HARADH CLINIC</td><td>Haradh Clinic</td><td><a href="tel:0569180911">056 918 0911</a></td></tr>
            <tr><td>Maher A. Jardali</td><td>Operation Manager</td><td><a href="tel:0505817134">050 581 7134</a></td></tr>
            <tr><td>Rifat Mehmood</td><td>Project Manager</td><td><a href="tel:0505366873">050 536 6873</a></td></tr>
            <tr><td>Shahzad Ahmad Khan</td><td>HSSE Manager</td><td><a href="tel:0543133645">054 313 3645</a></td></tr>
            <tr><td>Mahmoud Al Cheikh</td><td>Project Engineer</td><td><a href="tel:0551367496">055 136 7496</a></td></tr>
            <tr><td>Adnan Ghemrawi</td><td>Project Engineer (Hydrotest)</td><td><a href="tel:0500291404">050 029 1404</a></td></tr>
            <tr><td>Hassan El Cherbagi</td><td>Project Engineer</td><td><a href="tel:0539039724">053 903 9724</a></td></tr>
            <tr><td>Hadi Hamdi</td><td>Mechanical Engineer</td><td><a href="tel:0508838541">050 883 8541</a></td></tr>
            <tr><td>Imad El Hage</td><td>Project PMV Manager</td><td><a href="tel:0553713952">055 371 3952</a></td></tr>
            <tr><td>Rabih Hassan</td><td>Sr. Civil Engineer</td><td><a href="tel:0504838832">050 483 8832</a></td></tr>
            <tr><td>Om Prakash</td><td>HSSE Coordinator</td><td><a href="tel:0544303677">054 430 3677</a></td></tr>
            <tr><td>Tauqeer Nabi</td><td>Environmental Coordinator</td><td><a href="tel:0595820934">059 582 0934</a></td></tr>
            <tr><td>Irfan Haider</td><td>HSSE Supervisor</td><td><a href="tel:0590654748">059 065 4748</a></td></tr>
            <tr><td>Taha Ghemrawi</td><td>Sr. Transport Officer</td><td><a href="tel:0539195375">053 919 5375</a></td></tr>
            <tr><td>Abdul Karim</td><td>Material Supervisor</td><td><a href="tel:0502884442">050 288 4442</a></td></tr>
            <tr><td>Arif Khan</td><td>Safety officer/BLS/First Aider</td><td><a href="tel:0576563119">057 656 3119</a></td></tr>
            <tr><td>Dr. Ahmed Hussein</td><td>CAT Doctor</td><td><a href="tel:0562535421">056 253 5421</a></td></tr>
            <tr><td>Romelle M. Pagayon</td><td>Male Nurse</td><td><a href="tel:0531551924">053 155 1924</a></td></tr>
            <tr><td>Joe Franco V. Yabut</td><td>CAT First aider</td><td><a href="tel:0506735217">050 673 5217</a></td></tr>
            <tr><td>Shahid Bhatti</td><td>Ambulance Driver</td><td><a href="tel:0593886520">059 388 6520</a></td></tr>
          </tbody>
        </table>
      </div>

      <h3 class="emergency-subtitle">External Emergency Contacts</h3>
      <table class="emergency-table small">
        <thead>
          <tr>
            <th>Description</th>
            <th>Tel. Numbers</th>
            <th>Description</th>
            <th>Tel. Numbers</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Southern Area (Abqaiq)</td>
            <td><a href="tel:0135720911">013 572 0911</a></td>
            <td>Civil Defense (Fire)</td>
            <td><a href="tel:998">998</a></td>
          </tr>
          <tr>
            <td>Nadec Hospital (Haradh)</td>
            <td><a href="tel:0135849000">013 584 9000</a></td>
            <td>Red Crescent (Ambulance)</td>
            <td><a href="tel:997">997</a></td>
          </tr>
          <tr>
            <td>Al Ahsa Hospital (Al Hofuf)</td>
            <td><a href="tel:0135844000">013 584 4000</a></td>
            <td>Local Police</td>
            <td><a href="tel:999">999</a></td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td>Local Traffic Accident</td>
            <td><a href="tel:993">993</a></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- MAIN APP -->
  <div class="app-shell">
    <header class="header">
      <div class="header-left">
        <div class="header-app-name">My Observations App üë∑üèª‚Äç‚ôÇÔ∏è</div>
        <div class="header-subtitle">Daily safety cockpit</div>
      </div>
      <button
        class="mode-toggle"
        onclick="toggleDarkMode()"
        aria-label="Toggle dark mode"
      >
        <i id="modeIcon" class="fas fa-moon"></i>
      </button>
    </header>

    <main class="content-area">
      <!-- üè† HOME / DASHBOARD TAB -->
      <section id="HomeTab" class="tab-content active" aria-label="Home dashboard">
        <!-- Top KPI strip -->
        <div class="home-summary-grid">
          <div class="home-summary-card">
            <div class="home-summary-label">Observers Today</div>
            <div class="home-summary-value" id="homeObserversToday">--</div>
          </div>
          <div class="home-summary-card">
            <div class="home-summary-label">Observations Today</div>
            <div class="home-summary-value" id="homeObservationsToday">--</div>
          </div>
          <div class="home-summary-card">
            <div class="home-summary-label">Open High-Risk</div>
            <div class="home-summary-value" id="homeHighRiskOpen">--</div>
          </div>
        </div>

        <!-- TBT of the day -->
        <section class="home-section-card" id="homeTbtSection">
          <div class="home-section-header">
            <h3><i class="fas fa-book-open"></i> TBT of The Day</h3>
          </div>
          <div id="homeTbtContent">
            Loading TBT of the day...
          </div>
        </section>

        <!-- Mini leaderboard -->
        <section class="home-section-card" id="homeLeaderboardSection">
          <div class="home-section-header">
            <h3><i class="fas fa-trophy"></i> Top 3 This Month</h3>
            <button class="home-link-btn" onclick="showLeaderboardModal()">
              Full leaderboard
            </button>
          </div>
          <div id="homeLeaderboardMini">
            Loading leaderboard...
          </div>
        </section>

        <!-- Environment status -->
        <section class="home-section-card" id="homeEnvSection">
          <div class="home-section-header">
            <h3><i class="fas fa-temperature-high"></i> Environment Status</h3>
          </div>
          <div class="home-env-grid">
            <div class="home-env-item">
              <div class="home-env-label">Heat Index</div>
              <div class="home-env-value" id="homeHeatSummary">--</div>
            </div>
            <div class="home-env-item">
              <div class="home-env-label">Wind</div>
              <div class="home-env-value" id="homeWindSummary">--</div>
            </div>
          </div>
          <div class="home-env-hint">
            Use <strong>Tools</strong> tab for detailed Heat &amp; Wind calculations.
          </div>
        </section>

        <!-- Month color & EOM -->
        <p class="info-month">
          The Color Code of This Month is:
          <span id="colorName">...</span>
        </p>

        <section
          class="announcement-card"
          id="eomCard"
          style="cursor:pointer;"
        >
          <div class="eom-header">
            <span class="card-title">
              <i class="fas fa-trophy"></i> Employee of the Month:
            </span>
          </div>
          <div class="card-content" id="employeeOfMonth">
            Loading...
          </div>
        </section>

        <!-- Emergency & procedures accordions -->
        <button
          class="accordion"
          id="leaderboardAccordion"
          data-color="#0ea5e9"
          onclick="showLeaderboardModal()"
        >
          <i class="fas fa-list-ol"></i> Monthly Leaderboard
        </button>
        <div class="panel">
          <p>Tap to open the full leaderboard with all observers and points.</p>
        </div>

        <button
          class="accordion"
          id="contactsAccordion"
          data-color="#dc2626"
          onclick="showEmergencyContactsModal()"
        >
          <i class="fas fa-ambulance"></i> EMERGENCY CONTACTS
        </button>
        <div class="panel">
          <p>Tap to open emergency contacts with one-click calling.</p>
        </div>

        <button
          class="accordion"
          id="reportingAccordion"
          data-color="#f97316"
        >
          <i class="fas fa-exclamation-triangle"></i>
          EMERGENCY REPORTING PROCEDURES
        </button>
        <div class="panel" id="reportingPanel">
          <ol>
            <li>Dial the emergency number.</li>
            <li>Describe the exact location of the emergency.</li>
            <li>Describe the nature of the emergency.</li>
            <li>
              Identify the required service (Fire, Ambulance, Security) and
              repeat the message.
            </li>
            <li>Answer all questions from the operator.</li>
            <li>Do not hang up until instructed.</li>
          </ol>
          <button onclick="getGPSLocation()" class="gps-btn">
            <i class="fas fa-map-marker-alt"></i> Share My Location (GPS)
          </button>
          <div id="locationResult" class="gps-result"></div>
        </div>

        <button
          class="accordion"
          id="evacuationAccordion"
          data-color="#22c55e"
        >
          <i class="fas fa-door-open"></i> EVACUATION TIPS
        </button>
        <div class="panel" id="evacuationPanel">
          <ul>
            <li>Stop all work and shut down all equipment.</li>
            <li>Warn nearby personnel and proceed to the assembly area.</li>
            <li>Conduct roll call and account for all personnel.</li>
            <li>Wait for permission before re-entering the work area.</li>
          </ul>
        </div>

        <button
          class="accordion"
          id="safetyAccordion"
          data-color="#2563eb"
        >
          <i class="fas fa-user-shield"></i> Safety Responsibilities
        </button>
        <div class="panel" id="safetyPanel">
          <ol>
            <li>Report to site HSE / Safety Supervisor, Coordinator &amp; Manager.</li>
            <li>Demonstrate priority of safety by example.</li>
            <li>
              Understand contract HSE requirements (CSSP, HIP, JSA, GI‚Äôs, CSM,
              etc.).
            </li>
            <li>
              Conduct TBTs with workers and site supervision; maintain records.
            </li>
            <li>Conduct frequent HSE inspections and monitor activities.</li>
            <li>Report all NM, FAI, CA &amp; PA to the HSE Supervisor.</li>
            <li>Report all incidents causing injury or property damage.</li>
            <li>Report misuse of equipment, tools, or facilities.</li>
            <li>Report prejudice, bullying, or fighting immediately.</li>
            <li>Report any other HSE concerns.</li>
            <li>Ensure presence on site while activities are ongoing.</li>
            <li>Ensure proper and accurate reporting of all HSE issues.</li>
            <li>Follow up on all site HSE issues and close actions.</li>
            <li>Monitor &amp; close all PSI points, HSE findings &amp; observations.</li>
            <li>Ensure equipment is safe and operators are competent &amp; certified.</li>
            <li>
              Ensure scaffoldings, ladders, tools &amp; electrical equipment are
              safe.
            </li>
            <li>Maintain tidy jobsite; remove waste daily.</li>
            <li>Stop work if unsafe conditions exist (Stop Work Authority).</li>
            <li>Participate in incident investigations, drills, and trainings.</li>
            <li>Assist implementation of waste management plans.</li>
          </ol>
        </div>

        <button
          class="accordion"
          id="tbtAccordion"
          data-color="#f97316"
        >
          <i class="fas fa-book-open"></i> TBT of The Day
        </button>
        <div class="panel" id="tbtPanel">
          <!-- Filled dynamically with full TBT details -->
        </div>

        <button class="accordion" data-color="#6f42c1">
          <i class="fas fa-link"></i> Useful Links
        </button>
        <div class="panel">
          <ul>
            <li>
              <a
                href="https://drive.google.com/file/d/1JS1VQKXLHdOOFXpYcpRftM-kviBv-TYd/view?usp=sharing"
                target="_blank"
                >üìò CSM Book</a
              >
            </li>
            <li>
              <a
                href="https://drive.google.com/file/d/109vG3Hk3PdgvQF87k0EJ1IiKDTDfdQTv/view?usp=sharing"
                target="_blank"
                >üìó Saudi Aramco Safety Handbook</a
              >
            </li>
          </ul>
        </div>
      </section>

      <!-- üìä OBSERVATIONS TAB -->
      <section id="ObservationsTab" class="tab-content">
        <div class="obs-summary-bar">
          <div class="obs-summary-item">
            <div class="obs-summary-label">This Month</div>
            <div class="obs-summary-value" id="obsCountMonth">--</div>
          </div>
          <div class="obs-summary-item">
            <div class="obs-summary-label">Open</div>
            <div class="obs-summary-value" id="obsCountOpen">--</div>
          </div>
          <div class="obs-summary-item">
            <div class="obs-summary-label">Closed</div>
            <div class="obs-summary-value" id="obsCountClosed">--</div>
          </div>
        </div>

        <div class="obs-filters">
          <div class="obs-filter-row">
            <button class="obs-filter-chip active" data-range="today">
              Today
            </button>
            <button class="obs-filter-chip" data-range="week">This Week</button>
            <button class="obs-filter-chip" data-range="month">This Month</button>
            <button class="obs-filter-chip" data-range="all">All</button>
          </div>
          <div class="obs-filter-row">
            <select id="obsFilterRisk">
              <option value="">All Risks</option>
              <option value="High">High</option>
              <option value="Medium">Medium</option>
              <option value="Low">Low</option>
            </select>
            <select id="obsFilterStatus">
              <option value="">All Statuses</option>
              <option value="Open">Open</option>
              <option value="Closed">Closed</option>
              <option value="In Progress">In Progress</option>
            </select>
          </div>
          <div class="obs-filter-row">
            <input
              type="text"
              id="obsSearch"
              placeholder="Search by location, type, reporter..."
            />
          </div>
        </div>

        <div id="observationsList"></div>

        <button id="openSheetButton" class="obs-open-sheet-btn">
          <i class="fas fa-table"></i> Open full data sheet
        </button>

        <div
          id="observationsEmptyState"
          class="obs-empty-state"
          style="display:none;"
        >
          <i class="fas fa-database"></i>
          <p>
            No observations data loaded. Check observations configuration in
            <code>js/data.js</code>.
          </p>
        </div>
      </section>

      <!-- ‚úÖ DAILY TASKS (Google Form) -->
      <section id="TasksTab" class="tab-content">
        <div class="iframe-wrapper">
          <iframe
            id="tasksIframe"
            title="Daily Tasks Form"
            src=""
          ></iframe>
        </div>
      </section>

      <!-- üìö LIBRARY TAB (TBT + JSA) -->
      <section id="JSATab" class="tab-content">
        <div class="library-layout">
          <div class="library-column">
            <h3><i class="fas fa-book-open"></i> TBT Library</h3>
            <div id="tbtLibraryList"></div>
          </div>
          <div class="library-column">
            <h3><i class="fas fa-file-alt"></i> JSA Library</h3>
            <input
              type="text"
              id="jsaSearch"
              placeholder="Search JSA titles (e.g., Loading unloading)..."
            />
            <div id="jsaListContainer"></div>
          </div>
        </div>
      </section>

      <!-- üßÆ TOOLS TAB -->
      <section id="ToolsTab" class="tab-content">
        <div class="tool-toggle-container">
          <button
            class="tool-toggle-btn active-tool"
            data-tool="kpi"
            onclick="switchTool('kpi')"
          >
            Safety KPIs
          </button>
          <button
            class="tool-toggle-btn"
            data-tool="heat"
            onclick="switchTool('heat')"
          >
            Heat Stress
          </button>
          <button
            class="tool-toggle-btn"
            data-tool="wind"
            onclick="switchTool('wind')"
          >
            Wind Limits
          </button>
        </div>

        <!-- KPI Section -->
        <section id="kpiSection">
          <div class="tools-section-header">
            <i class="fas fa-calculator"></i>
            <div>
              <h3>Safety KPI Calculator</h3>
              <small>Based on Saudi Aramco CSM &amp; Safety Handbook</small>
            </div>
          </div>
          <div id="kpiListContainer"></div>
        </section>

        <!-- Heat Stress Section -->
        <section id="heatStressSection" style="display:none;">
          <div class="tools-section-header heat">
            <i class="fas fa-sun"></i>
            <div>
              <h3>Heat Stress Calculator</h3>
              <small>Calculate Heat Index &amp; Hazard Level</small>
            </div>
          </div>

          <div class="kpi-card heat">
            <div class="kpi-input-group">
              <label>Air Temperature (¬∞C)</label>
              <input
                type="number"
                id="inputTemp"
                class="kpi-input-field"
                placeholder="e.g., 35"
                oninput="calculateHeatIndex()"
              />
            </div>
            <div class="kpi-input-group">
              <label>Relative Humidity (%)</label>
              <input
                type="number"
                id="inputHumidity"
                class="kpi-input-field"
                placeholder="e.g., 40"
                oninput="calculateHeatIndex()"
              />
            </div>
          </div>

          <div id="heatIndexResultCard">
            <div>HEAT INDEX</div>
            <div class="heat-value" id="heatIndexValue">--</div>
            <div class="heat-category" id="heatRiskLevel">--</div>
            <div class="heat-recommendations">
              <ul id="heatRecommendationsList">
                <li>Enter temperature and humidity to see results.</li>
              </ul>
            </div>
          </div>
        </section>

        <!-- Wind Speed Section -->
        <section id="windSpeedSection" style="display:none;">
          <div class="tools-section-header wind">
            <i class="fas fa-wind"></i>
            <div>
              <h3>Wind Speed Safety Limits</h3>
              <small>Based on CSM Vol II (Cranes &amp; Manbaskets)</small>
            </div>
          </div>

          <div class="kpi-card wind">
            <div class="kpi-input-group">
              <label>Current Wind Speed (km/h)</label>
              <input
                type="number"
                id="inputWind"
                class="kpi-input-field"
                placeholder="e.g., 25"
                oninput="calculateWindSafety()"
              />
            </div>
          </div>

          <div id="windSpeedResultCard">
            <div>STATUS</div>
            <div class="wind-value" id="windValue">--</div>
            <div class="wind-category" id="windRiskLevel">--</div>
            <div class="wind-recommendations">
              <ul id="windRecommendationsList">
                <li>Enter wind speed to see limits.</li>
              </ul>
            </div>
          </div>
        </section>
      </section>

      <!-- üì∞ NEWS TAB -->
      <section id="NewsTab" class="tab-content">
        <div id="AnnouncementsContainer">
          <div id="newsLoading" class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i> Fetching news...
          </div>
        </div>
      </section>
    </main>

    <!-- Floating Add Observation Button -->
    <a
      id="addObservationButton"
      href="#"
      target="_blank"
    >
      <i class="fas fa-plus"></i> Add New Observation
    </a>

    <!-- Floating Emergency Button -->
    <button
      id="emergencyQuickButton"
      onclick="showEmergencyContactsModal()"
      title="Emergency Contacts"
    >
      <i class="fas fa-ambulance"></i>
    </button>

    <!-- Bottom Navigation -->
    <nav class="nav-bar" role="tablist">
      <button
        class="nav-button active"
        data-color="var(--danger-color)"
        onclick="openTab(event, 'HomeTab')"
        role="tab"
        aria-selected="true"
      >
        <span class="nav-icon"><i class="fas fa-house"></i></span>
        <span>Home</span>
      </button>
      <button
        class="nav-button"
        data-color="var(--success-color)"
        onclick="openTab(event, 'ObservationsTab')"
        role="tab"
      >
        <span class="nav-icon"><i class="fas fa-chart-line"></i></span>
        <span>Observations</span>
      </button>
      <button
        class="nav-button"
        data-color="#6f42c1"
        onclick="openTab(event, 'TasksTab')"
        role="tab"
      >
        <span class="nav-icon"><i class="fas fa-list-check"></i></span>
        <span>Tasks</span>
      </button>
      <button
        class="nav-button"
        data-color="var(--jsa-color)"
        onclick="openTab(event, 'JSATab')"
        role="tab"
      >
        <span class="nav-icon"><i class="fas fa-handshake"></i></span>
        <span>Library</span>
      </button>
      <button
        class="nav-button"
        data-color="var(--kpi-color)"
        onclick="openTab(event, 'ToolsTab')"
        role="tab"
      >
        <span class="nav-icon"><i class="fas fa-calculator"></i></span>
        <span>Tools</span>
      </button>
      <button
        class="nav-button"
        data-color="#0ea5e9"
        onclick="openTab(event, 'NewsTab')"
        role="tab"
      >
        <span class="nav-icon"><i class="fas fa-bullhorn"></i></span>
        <span>News</span>
      </button>
    </nav>
  </div>

  <!-- JS: data (links, TBT, JSA) then app logic -->
  <script src="js/data.js" defer></script>
  <script src="js/app.js" defer></script>
</body>
</html>
